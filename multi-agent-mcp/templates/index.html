<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>GOC_AgenticAI</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/styles-footer.css">
    <!-- Load Chart.js globally so it's always available -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <aside class="sidebar">
        <button class="new-chat" onclick="newChat()">‚ûï New Chat</button>
        
        <!-- History with search -->
        <div class="history">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>üìú History</h2>
                <button onclick="clearHistory();" class="clear-history-btn" title="Clear all history">üóëÔ∏è</button>
            </div>
            <input type="text" id="history-search" placeholder="üîç Search history..." style="width: 100%; padding: 6px; margin: 8px 0; background: #333; border: 1px solid #444; border-radius: 4px; color: #f0f0f0; font-size: 12px;">
            <ul id="history-list"></ul>
        </div>
        
        <!-- Auto Status Monitor - Single Column -->
        <div class="status-monitor">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>üåê Arlo Status <span id="status-time" style="font-size: 10px; color: #999;"></span></h2>
                <button onclick="loadStatusMonitor()" class="refresh-status-btn" title="Refresh status">üîÑ</button>
            </div>
            <div id="status-summary" style="font-size: 11px; padding: 5px; background: #333; border-radius: 4px; margin-bottom: 8px;">
                Loading...
            </div>
            <h3 style="font-size: 12px; margin: 8px 0 4px 0; color: #bbb;">Core Services</h3>
            <ul id="status-services" style="list-style: none; padding: 0; font-size: 10px; margin-bottom: 12px;">
                <li style="padding: 4px; color: #999;">Loading...</li>
            </ul>
            <h3 style="font-size: 12px; margin: 8px 0 4px 0; color: #bbb;">Past Incidents</h3>
            <ul id="status-incidents" style="list-style: none; padding: 0; font-size: 10px;">
                <li style="padding: 4px; color: #999;">Loading...</li>
            </ul>
        </div>
        
    </aside>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p style="font-size: 18px; margin: 10px 0; font-weight: bold;">Processing your request...</p>
            <div style="margin: 15px 0; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
                <p style="font-size: 14px; margin: 5px 0; color: #60a5fa;">
                    <strong>Tools:</strong> <span id="loading-tools-list">-</span>
                </p>
                <p style="font-size: 14px; margin: 5px 0; color: #fbbf24;">
                    <strong>Time:</strong> <span id="loading-time-counter">0s</span>
                </p>
            </div>
            <div class="loading-bar">
                <div class="loading-bar-fill"></div>
            </div>
        </div>
    </div>

    <main class="chat-area">
        <header class="top-bar">
            <span>üß† GOC_AgenticAI üß†</span>
            <button onclick="toggleTheme()" class="theme-toggle" title="Toggle light/dark theme">üåì</button>
        </header>
        
        <!-- Two Column Layout: How to Use + PagerDuty -->
        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 20px; margin-bottom: 20px;">
            <!-- Left Column: How to Use -->
            <div class="prompt">
                <strong style="font-size: 1.15rem;">How to use:</strong><br>
                <span style="color: #20d6ca;">1Ô∏è‚É£ Select one or more tools from the checkboxes below</span><br>
                <span style="color: #ff9500; margin-left: 20px;">‚ö†Ô∏è If you select DD_Red_Metrics, DD_Red_ADT or DD_Errors, choose a Time Range</span><br>
                <span style="color: #20d6ca;">2Ô∏è‚É£ Type your search query (optional for some tools)</span><br>
                <span style="color: #20d6ca;">3Ô∏è‚É£ Click Send button</span><br>"
                <span style="color: #fbbf24; font-style: italic;">üí° Example: Select "DD_Red_Metrics","DD_Red_ADT" type "streaming-service", then click Send</span>
            </div>
            
            <!-- Right Column: PagerDuty Monitor -->
            <div class="pagerduty-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2 style="margin: 0; font-size: 16px; color: #20d6ca;">üö® PagerDuty Status</h2>
                    <button onclick="loadPagerDutyMonitor()" class="refresh-status-btn" title="Refresh PagerDuty" style="font-size: 16px;">üîÑ</button>
                </div>
                <div id="pd-summary" style="font-size: 12px; padding: 10px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; margin-bottom: 12px; color: white; text-align: center;">
                    Loading...
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <div>
                        <h3 style="font-size: 13px; margin: 0 0 8px 0; color: var(--text-secondary); font-weight: bold;">üî¥ Active</h3>
                        <ul id="pd-active" style="list-style: none; padding: 0; margin: 0; font-size: 11px; max-height: 120px; overflow-y: auto;">
                            <li style="padding: 6px; color: #999; background: var(--bg-tertiary); border-radius: 4px;">Loading...</li>
                        </ul>
                    </div>
                    <div>
                        <h3 style="font-size: 13px; margin: 0 0 8px 0; color: var(--text-secondary); font-weight: bold;">üü¢ Resolved</h3>
                        <ul id="pd-resolved" style="list-style: none; padding: 0; margin: 0; font-size: 11px; max-height: 120px; overflow-y: auto;">
                            <li style="padding: 6px; color: #999; background: var(--bg-tertiary); border-radius: 4px;">Loading...</li>
                        </ul>
                    </div>
                </div>
                <div style="margin-top: 10px; font-size: 10px; color: var(--text-secondary); text-align: center;">
                    <span id="pd-time">Last updated: --:--:--</span>
                </div>
            </div>
        </div>
        
        <!-- ‚úÖ Formulario con ID para JS -->
        <form id="search-form" class="input-form">
            <div class="tool-list" id="tool-list"></div>
            
            <!-- Time range selector for Datadog tools -->
            <div id="timerange-container" style="display: none; margin: 10px 0; padding: 10px; background-color: #f0f4f8; border-radius: 4px;">
                <label for="timerange-select" style="font-weight: bold; margin-right: 10px; color: #2d3748;">Time Range:</label>
                <select id="timerange-select" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #cbd5e0; font-size: 14px;">
                    <option value="1">1 hour</option>
                    <option value="2">2 hours</option>
                    <option value="4" selected>4 hours</option>
                    <option value="48">2 days</option>
                    <option value="96">4 days</option>
                    <option value="168">1 week</option>
                </select>
            </div>
            
            <textarea name="input" id="input-text" placeholder="Enter service name, ticket ID, or search query... (optional for some tools)"></textarea>
            <button type="submit">Send</button>
        </form>

        <!-- ‚úÖ Elementos para mensajes y contador -->
        <p id="loading-message"></p>
        <p id="counter"></p>
        <div id="final-counter"></div>
        
        <!-- Download button -->
        <div id="download-container" style="display: none; margin: 15px 0; text-align: right;">
            <button id="download-doc-btn" onclick="downloadResults()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); transition: all 0.3s;">
                üì• Download Results (.docx)
            </button>
        </div>
        
        <div id="results-box"></div>
        <!-- ‚úÖ Tabla de alertas -->
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <span>GOC AgenticAI v2.0.0</span>
                <span>|</span>
                <span id="last-update">Last update: --</span>
            </div>
        </footer>
    </main>

    <script src="/static/js/scripts.js?v=20260205-v9"></script>
    <script>
        // ‚ÑπÔ∏è Las funciones loadHistory() y showHistoryResult() ahora est√°n en scripts.js
        // ‚ÑπÔ∏è La carga de herramientas tambi√©n est√° en scripts.js en el DOMContentLoaded
    
        function loadAlerts() {
            fetch('/api/alerts/status')
                .then(res => res.json())
                .then(alerts => {
                    const tbody = document.querySelector('#alerts-table tbody');
                    if (!tbody) return; // Skip if table doesn't exist
                    tbody.innerHTML = '';
                    alerts.forEach(alert => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${alert.id}</td>
                            <td>${alert.text}</td>
                            <td style="font-weight:bold;color:${alert.priority==='Alta'?'red':alert.priority==='Media'?'orange':'green'}">${alert.priority}</td>
                            <td>${alert.ack?'‚úÖ':'‚ùå'}</td>
                            <td>${alert.cause}</td>
                            <td>${alert.ack?'':'<button onclick="ackAlert('+alert.id+')">ACK</button>'}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }
        function ackAlert(id) {
            fetch(`/api/alerts/ack/${id}`, {method:'POST'}).then(()=>loadAlerts());
        }
        setInterval(loadAlerts, 60000);
        document.addEventListener('DOMContentLoaded', loadAlerts);
    
    </script>
</body>
</html>

