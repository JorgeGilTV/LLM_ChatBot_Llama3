<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <title>Arlo_GenAI</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/styles-footer.css">
    <!-- Load Chart.js globally so it's always available -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <aside class="sidebar">
        <button class="new-chat" onclick="newChat()">‚ûï New Chat</button>
        
        <!-- History with search -->
        <div class="history">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>History</h2>
                <button onclick="clearHistory()" class="clear-history-btn" title="Clear all history">üóëÔ∏è</button>
            </div>
            <input type="text" id="history-search" placeholder="üîç Search history..." style="width: 100%; padding: 6px; margin: 8px 0; background: #333; border: 1px solid #444; border-radius: 4px; color: #f0f0f0; font-size: 12px;">
            <ul id="history-list"></ul>
        </div>
        
        <!-- Auto Status Monitor -->
        <div class="status-monitor">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>Arlo Status <span id="status-time" style="font-size: 10px; color: #999;"></span></h2>
                <button onclick="loadStatusMonitor()" class="refresh-status-btn" title="Refresh status">üîÑ</button>
            </div>
            <div id="status-summary" style="font-size: 11px; padding: 5px; background: #333; border-radius: 4px; margin-bottom: 8px;">
                Loading...
            </div>
            <h3 style="font-size: 12px; margin: 8px 0 4px 0; color: #bbb;">Core Services</h3>
            <ul id="status-services" style="list-style: none; padding: 0; font-size: 10px; margin-bottom: 12px;">
                <li style="padding: 4px; color: #999;">Loading...</li>
            </ul>
            <h3 style="font-size: 12px; margin: 8px 0 4px 0; color: #bbb;">Past Incidents</h3>
            <ul id="status-incidents" style="list-style: none; padding: 0; font-size: 10px;">
                <li style="padding: 4px; color: #999;">Loading...</li>
            </ul>
        </div>
    </aside>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Processing your request...</p>
            <div class="loading-bar">
                <div class="loading-bar-fill"></div>
            </div>
        </div>
    </div>

    <main class="chat-area">
        <header class="top-bar">
            <span>üß† Arlo_GenAI üß†</span>
            <button onclick="toggleTheme()" class="theme-toggle" title="Toggle light/dark theme">üåì</button>
        </header>
        <div class="prompt">
            <strong style="font-size: 1.15rem;">How to use:</strong><br>
            <span style="color: #20d6ca;">1Ô∏è‚É£ Select one or more tools from the checkboxes below</span><br>
            <span style="color: #ff9500; margin-left: 20px;">‚ö†Ô∏è If you select DD_Red_Metrics, DD_Red_ADT, DD_Errors or P0_Streaming, choose a Time Range</span><br>
            <span style="color: #20d6ca;">2Ô∏è‚É£ Type your search query (optional for some tools)</span><br>
            <span style="color: #20d6ca;">3Ô∏è‚É£ Click Send button</span><br><br>
            <span style="color: #fbbf24; font-style: italic;">üí° Example: Select "DD_Red_Metrics" + "P0_Streaming", type "streaming-service", then click Send</span>
        </div>
        
        <!-- ‚úÖ Formulario con ID para JS -->
        <form id="search-form" class="input-form">
            <div class="tool-list" id="tool-list"></div>
            
            <!-- Time range selector for Datadog tools -->
            <div id="timerange-container" style="display: none; margin: 10px 0; padding: 10px; background-color: #f0f4f8; border-radius: 4px;">
                <label for="timerange-select" style="font-weight: bold; margin-right: 10px; color: #2d3748;">Time Range:</label>
                <select id="timerange-select" style="padding: 5px 10px; border-radius: 4px; border: 1px solid #cbd5e0; font-size: 14px;">
                    <option value="1">1 hour</option>
                    <option value="2">2 hours</option>
                    <option value="4" selected>4 hours</option>
                    <option value="48">2 days</option>
                    <option value="96">4 days</option>
                    <option value="168">1 week</option>
                </select>
            </div>
            
            <textarea name="input" id="input-text" placeholder="Enter service name, ticket ID, or search query... (optional for some tools)"></textarea>
            <button type="submit">Send</button>
        </form>

        <!-- ‚úÖ Elementos para mensajes y contador -->
        <p id="loading-message"></p>
        <p id="counter"></p>
        <div id="final-counter"></div>
        <div id="results-box"></div>
        <!-- ‚úÖ Tabla de alertas -->
        
        <!-- Footer -->
        <footer class="app-footer">
            <div class="footer-content">
                <span>Arlo GenAI v2.0.0</span>
                <span>|</span>
                <span id="last-update">Last update: --</span>
            </div>
        </footer>
    </main>

    <script src="/static/js/scripts.js?v=20260205-v9"></script>
    <script>
        // ‚ÑπÔ∏è Las funciones loadHistory() y showHistoryResult() ahora est√°n en scripts.js
        // ‚ÑπÔ∏è La carga de herramientas tambi√©n est√° en scripts.js en el DOMContentLoaded
    
        function loadAlerts() {
            fetch('/api/alerts/status')
                .then(res => res.json())
                .then(alerts => {
                    const tbody = document.querySelector('#alerts-table tbody');
                    if (!tbody) return; // Skip if table doesn't exist
                    tbody.innerHTML = '';
                    alerts.forEach(alert => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${alert.id}</td>
                            <td>${alert.text}</td>
                            <td style="font-weight:bold;color:${alert.priority==='Alta'?'red':alert.priority==='Media'?'orange':'green'}">${alert.priority}</td>
                            <td>${alert.ack?'‚úÖ':'‚ùå'}</td>
                            <td>${alert.cause}</td>
                            <td>${alert.ack?'':'<button onclick="ackAlert('+alert.id+')">ACK</button>'}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }
        function ackAlert(id) {
            fetch(`/api/alerts/ack/${id}`, {method:'POST'}).then(()=>loadAlerts());
        }
        setInterval(loadAlerts, 60000);
        document.addEventListener('DOMContentLoaded', loadAlerts);
    
    </script>
</body>
</html>

