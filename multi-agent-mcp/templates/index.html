<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GenDox AI</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <aside class="sidebar">
        <button class="new-chat" onclick="newChat()">‚ûï New Chat</button>
        <div class="history">
            <h2>History</h2>
            <ul id="history-list"></ul>
        </div>
    </aside>
    <main class="chat-area">
        <header class="top-bar">üß† GenDox AI üß†</header>
        <div class="prompt">
            Please start typing some prompt, CDEX or Topic to search... 
            /help‚ùì Help /settings‚öôÔ∏è Settings /about‚ÑπÔ∏è About
        </div>
        
        <!-- ‚úÖ Formulario con ID para JS -->
        <form id="search-form" class="input-form">
            <div class="tool-list" id="tool-list"></div>
            <textarea name="input" id="input-text" placeholder="Please insert your search, select the tool in check box and press Send?"></textarea>
            <button type="submit">Send</button>
        </form>

        <!-- ‚úÖ Elementos para mensajes y contador -->
        <p id="loading-message"></p>
        <p id="counter"></p>
        <div id="final-counter"></div>
        <div id="results-box"></div>
        <div id="history-result"></div> <!-- Aqu√≠ se mostrar√°n los resultados -->
        <!-- ‚úÖ Tabla de alertas -->
        <section id="alerts-section" style="margin-top:2rem;">
            <h2 style="color:#6f2da8;">üì¢ Active Alerts</h2>
            <table id="alerts-table">
                <thead>
                    <tr>
                        <th>ID</th><th>Texto</th><th>Prioridad</th><th>ACK</th><th>Causa ra√≠z</th><th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
    </main>

    <script src="/static/js/scripts.js"></script>
    <script>
        // ‚úÖ Cargar historial desde archivo JSON
        fetch('/search_history.json')
            .then(res => {
                if (!res.ok) throw new Error("No se pudo cargar el archivo JSON");
                return res.json();
            })
            .then(data => {
                window.historyData = data;
                const historyList = document.getElementById("history-list");
                historyList.innerHTML = '';

                data.forEach((item, index) => {
                    const li = document.createElement("li");
                    const btn = document.createElement("button");
                    btn.textContent = item.query; // nombre real de la consulta
                    btn.onclick = () => showHistoryResult(index);
                    li.appendChild(btn);
                    historyList.appendChild(li);
                });
            })
            .catch(err => console.error('Error cargando historial:', err));

        // ‚úÖ Renderizar herramientas con checkbox
        const tools = [
            { name: "Read_Itrack", desc: "Read workarounds from AT&T itrack" },
            { name: "Read_Wiki", desc: "Read documents from AT&T Wiki" },
            { name: "How_to_fix", desc: "Generate recommendations using LLaMA with JIRA, Grafana, and Wiki" },
            { name: "MCP_Connect", desc: "Check if MCP server is active" },
            { name: "Ask_Gemini", desc: "Ask LLM Gemini about anything" },
            { name: "Ask_Copilot", desc: "Ask LLM Copilot about anything" }
        ];

        const toolList = document.getElementById("tool-list");
        tools.forEach(tool => {
            const label = document.createElement("label");
            label.className = "tool-item";
            label.title = tool.desc;
            label.innerHTML = `<input type="checkbox" name="tool" value="${tool.name}"> ${tool.name}`;
            toolList.appendChild(label);
        });

        // ‚úÖ Mostrar resultado de historial
        function showHistoryResult(index) {
            const resultContainer = document.getElementById("history-result");
            resultContainer.innerHTML = window.historyData[index].result;
        }
    
        function loadAlerts() {
            fetch('/api/alerts/status')
                .then(res => res.json())
                .then(alerts => {
                    const tbody = document.querySelector('#alerts-table tbody');
                    tbody.innerHTML = '';
                    alerts.forEach(alert => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${alert.id}</td>
                            <td>${alert.text}</td>
                            <td style="font-weight:bold;color:${alert.priority==='Alta'?'red':alert.priority==='Media'?'orange':'green'}">${alert.priority}</td>
                            <td>${alert.ack?'‚úÖ':'‚ùå'}</td>
                            <td>${alert.cause}</td>
                            <td>${alert.ack?'':'<button onclick="ackAlert('+alert.id+')">ACK</button>'}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                });
        }
        function ackAlert(id) {
            fetch(`/api/alerts/ack/${id}`, {method:'POST'}).then(()=>loadAlerts());
        }
        setInterval(loadAlerts, 60000);
        document.addEventListener('DOMContentLoaded', loadAlerts);
    
    </script>
</body>
</html>

